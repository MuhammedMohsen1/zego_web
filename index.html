<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="Permissions-Policy" content="camera=(), microphone=(), geolocation=()">
</head>

<body>
  <div id="root"></div>

  <script src="https://unpkg.com/@zegocloud/zego-uikit-prebuilt/zego-uikit-prebuilt.js"></script>

  <script>
    var zp;
    
    // // Function to generate a random user ID
    // function generateRandomUserId(length) {
    //   var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
    //   var result = '';
    //   for (var i = 0; i < length; i++) {
    //     result += characters.charAt(Math.floor(Math.random() * characters.length));
    //   }
    //   return result;
    // }
//     function stringToBool(str) {
//   return str.toLowerCase() === 'true';
// }
    // Function to initialize Zego
    function initZego(details) {
      console.log("Initializing Zego with details:", details);
      const roomID = 'details.roomID'; 
      const userID = generateRandomUserId(20); 
      const userName = details.userName; 
      const appID = 1588161922;
      const serverSecret = "13c5fcf0857cd10bb582b2866e169cf269ed115e1235fda3be39bd44d9c0bc84";
      const showScreenSharing = false;
      // // Log all parameters and their data types
      // console.log("roomID:", roomID, "Type:", typeof roomID);
      // console.log("userID:", userID, "Type:", typeof userID);
      // console.log("userName:", userName, "Type:", typeof userName);
      // console.log("appID:", appID, "Type:", typeof appID);
      // console.log("serverSecret:", serverSecret, "Type:", typeof serverSecret);
      // console.log("showScreenSharing:", showScreenSharing, "Type:", typeof showScreenSharing);

      // Generate a Kit Token by calling a method.
      const kitToken = ZegoUIKitPrebuilt.generateKitTokenForTest(appID, serverSecret, roomID, userID, userName);
      
      zp = ZegoUIKitPrebuilt.create(kitToken);

      zp.joinRoom({
        container: document.querySelector("#root"),
        scenario: {
          mode: ZegoUIKitPrebuilt.VideoConference,
        },
        showRoomTimer: true,
        showPreJoinView: false,
        turnOnCameraWhenJoining: true,
        showMyCameraToggleButton: true,
        showAudioVideoSettingsButton: true,
        showScreenSharingButton: false,
        screenSharingConfig: {
          resolution: ZegoUIKitPrebuilt.ScreenSharingResolution_720P
        },
        showLeavingView: false,
        showLeaveRoomConfirmDialog: false,
        onJoinRoom: () => {
          console.log("onJoinRoom");
          window.parent.postMessage({ type: 'onJoinRoom' }, '*');
          console.log("message sent");
        },
        onLeaveRoom: () => {
          console.log("Left the room");
          window.parent.postMessage({ type: 'onLeaveRoom' }, '*');
          console.log("message sent");
        },
       
        onUserJoin: () => {
          console.log("onUserJoin");
          window.parent.postMessage({ type: 'onUserJoin' }, '*');
          console.log("message sent");
        
        },
        onUserLeave: () => {
          console.log("onUserLeave");
          window.parent.postMessage({ type: 'onUserLeave' }, '*');
          console.log("message sent");
        },
      });
    }

    window.addEventListener('message', function(event) {
      console.log("event happened");
      if (event.data && event.data.type === 'init_zego') {
        console.log("init_zego is triggered");
        initZego(event.data.details);
      }
    });

    // // Dispatch the custom event to initialize Zego if needed
    // document.addEventListener('DOMContentLoaded', function() {
    //   var event = new CustomEvent('init_zego');
    //   document.dispatchEvent(event);
    // });

  </script>
</body>

</html>
